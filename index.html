function renderMarkdown(md) {
  let s = md;

  // Escape HTML
  s = s.replace(/[&<>]/g, ch => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" }[ch]));

  // Code blocks ``` ```
  s = s.replace(/```([\s\S]*?)```/g, (m, code) =>
    `<pre><code>${code.trim()}</code></pre>`
  );

  // Inline code `code`
  s = s.replace(/`([^`]+)`/g, `<code>$1</code>`);

  // Headings
  s = s.replace(/^### (.*)$/gm, `<h3>$1</h3>`);
  s = s.replace(/^## (.*)$/gm, `<h2>$1</h2>`);
  s = s.replace(/^# (.*)$/gm, `<h1>$1</h1>`);

  // Bold and italic
  s = s.replace(/\*\*(.*?)\*\*/g, `<b>$1</b>`);
  s = s.replace(/\*(.*?)\*/g, `<i>$1</i>`);

  // Blockquotes
  s = s.replace(/^> (.*)$/gm, `<blockquote>$1</blockquote>`);

  // Links
  s = s.replace(/\[([^\]]+)\]\(([^)]+)\)/g, `<a href="$2" target="_blank">$1</a>`);

  // Tables
  s = s.replace(/((?:\|.*\n)+)/g, block => {
    const lines = block.trim().split("\n");
    if (lines.length < 2) return block;

    const header = lines[0].split("|").slice(1, -1).map(x => x.trim());
    const rows = lines.slice(2).map(line =>
      line.split("|").slice(1, -1).map(x => x.trim())
    );

    let html = "<table style='border-collapse:collapse;margin:10px 0;'>";
    html += "<thead><tr>";
    header.forEach(h =>
      html += `<th style="border:1px solid #ccc;padding:6px 10px;background:#f5f5f5;">${h}</th>`
    );
    html += "</tr></thead><tbody>";

    rows.forEach(row => {
      html += "<tr>";
      row.forEach(cell =>
        html += `<td style="border:1px solid #ccc;padding:6px 10px;">${cell}</td>`
      );
      html += "</tr>";
    });

    html += "</tbody></table>";
    return html;
  });

  // Unordered lists
  s = s.replace(/^(?:-|\*) (.*)$/gm, `<li>$1</li>`);
  s = s.replace(/(<li>[\s\S]*?<\/li>)/g, `<ul>$1</ul>`);

  // Paragraphs
  s = s.replace(/^(?!<h\d|<ul|<pre|<table|<blockquote|<li)(.+)$/gm,
    `<p>$1</p>`
  );

  return s;
}
