<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width">
<title>Folders with Subfolders Editor</title>

<style>
body {
    margin: 0;
    font-family: "Roboto", sans-serif;
    display: flex;
    height: 100vh;
}

/* –õ–µ–≤–æ–µ –º–µ–Ω—é */
#sidebar {
    width: 260px;
    background: #f0f0f0;
    border-right: 2px solid #ccc;
    padding: 10px;
    overflow-y: auto;
    box-sizing: border-box;
}

.folder {
    padding: 6px;
    margin: 3px 0;
    cursor: pointer;
    user-select: none;
}

.folder.active {
    background: #bbb;
    border-radius: 6px;
    font-weight: bold;
}

/* –û—Ç—Å—Ç—É–ø—ã –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ */
.folder .title {
    display: flex;
    gap: 4px;
    align-items: center;
}

.children {
    margin-left: 20px;
    border-left: 1px dashed #aaa;
    padding-left: 10px;
}

/* –ü—Ä–∞–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä */
#editor {
    flex: 1;
    padding: 20px;
}

.editable {
    padding: 15px;
    border: 2px dashed #888;
    border-radius: 10px;
    min-height: 200px;
    font-size: 18px;
}

/* –ö–Ω–æ–ø–∫–∏ */
button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä -->
<div id="sidebar">
    <h3>–ü–∞–ø–∫–∏</h3>

    <div id="folderTree"></div>

    <button id="createFolderBtn">–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</button>
    <button id="createSubFolderBtn">–°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∞–ø–∫—É</button>
</div>

<!-- –ü—Ä–∞–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
<div id="editor">
    <div id="editableContent"
         class="editable"
         contenteditable="true">
         –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é.
    </div>
</div>

<script>
// –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–∞–ø–æ–∫
let folders = JSON.parse(localStorage.getItem("foldersTree")) || {};
let currentFolder = null;

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
function saveFolders() {
    localStorage.setItem("foldersTree", JSON.stringify(folders));
}

// –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
function uid() {
    return "f_" + Math.random().toString(36).substr(2, 9);
}

// –†–µ–Ω–¥–µ—Ä –¥–µ—Ä–µ–≤–∞
function renderFolderTree() {
    const container = document.getElementById("folderTree");
    container.innerHTML = "";

    const renderNode = (node, parentEl) => {
        const div = document.createElement("div");
        div.className = "folder";
        if (node.id === currentFolder) div.classList.add("active");

        const title = document.createElement("div");
        title.className = "title";

        // –ò–∫–æ–Ω–∫–∞ –ø–∞–ø–∫–∏ + —Å—Ç—Ä–µ–ª–∫–∞
        const arrow = document.createElement("span");
        arrow.textContent = node.collapsed ? "‚ñ∂" : "‚ñº";

        const icon = document.createElement("span");
        icon.textContent = "üìÅ";

        const text = document.createElement("span");
        text.textContent = node.title;

        title.appendChild(arrow);
        title.appendChild(icon);
        title.appendChild(text);
        div.appendChild(title);

        // –ö–ª–∏–∫ –ø–æ –ø–∞–ø–∫–µ
        title.onclick = () => {
            node.collapsed = !node.collapsed; // —Å–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å
            currentFolder = node.id;          // –≤—ã–¥–µ–ª–∏—Ç—å
            editableContent.innerHTML = node.content; // –∑–∞–≥—Ä—É–∑–∏—Ç—å
            saveFolders();
            renderFolderTree();
        };

        parentEl.appendChild(div);

        // –ï—Å–ª–∏ —Å–≤—ë—Ä–Ω—É—Ç–∞ ‚Äî –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ
        if (node.collapsed) return;

        // –î–µ—Ç–∏
        if (node.children.length > 0) {
            const childrenDiv = document.createElement("div");
            childrenDiv.className = "children";
            parentEl.appendChild(childrenDiv);

            node.children.forEach(child => renderNode(child, childrenDiv));
        }
    };

    Object.values(folders).forEach(root => {
        renderNode(root, container);
    });
}

// –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É
document.getElementById("createFolderBtn").onclick = () => {
    const title = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏:");
    if (!title) return;

    const id = uid();

    folders[id] = {
        id,
        title,
        content: "–ù–æ–≤–∞—è –ø–∞–ø–∫–∞‚Ä¶",
        children: [],
        collapsed: false
    };

    currentFolder = id;
    saveFolders();
    renderFolderTree();
};

// –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∞–ø–∫—É
document.getElementById("createSubFolderBtn").onclick = () => {
    if (!currentFolder) {
        alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É.");
        return;
    }

    const parent = findFolderById(currentFolder);

    const title = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∞–ø–∫–∏:");
    if (!title) return;

    const id = uid();

    parent.children.push({
        id,
        title,
        content: "–ù–æ–≤–∞—è –ø–æ–¥–ø–∞–ø–∫–∞‚Ä¶",
        children: [],
        collapsed: false
    });

    saveFolders();
    renderFolderTree();
};

// –ü–æ–∏—Å–∫ –≤ –≥–ª—É–±–∏–Ω—É
function findFolderById(id) {
    for (let root of Object.values(folders)) {
        if (root.id === id) return root;

        let found = findChild(root, id);
        if (found) return found;
    }
    return null;
}

function findChild(node, id) {
    for (let child of node.children) {
        if (child.id === id) return child;

        let found = findChild(child, id);
        if (found) return found;
    }
    return null;
}

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
document.getElementById("editableContent").addEventListener("input", () => {
    if (!currentFolder) return;
    const folder = findFolderById(currentFolder);
    folder.content = editableContent.innerHTML;
    saveFolders();
});

// –°—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
renderFolderTree();
</script>

</body>
</html>
