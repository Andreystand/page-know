<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width">
<title>Editable Multi-Page System with Subpages</title>

<style>
body {
    margin: 0;
    font-family: "Roboto", sans-serif;
    display: flex;
    height: 100vh;
}

/* ЛЕВОЕ МЕНЮ */
#sidebar {
    width: 250px;
    background: #f0f0f0;
    border-right: 2px solid #ccc;
    padding: 10px;
    overflow-y: auto;
}

.page-item {
    padding: 8px;
    margin: 4px 0;
    background: #ddd;
    cursor: pointer;
    border-radius: 6px;
}

.page-item.active {
    background: #bbb;
    font-weight: bold;
}

.subpage {
    margin-left: 20px;
}

/* Правый редактор */
#editor {
    flex: 1;
    padding: 20px;
}

.editable {
    padding: 15px;
    border: 2px dashed #888;
    border-radius: 10px;
    min-height: 200px;
    font-size: 18px;
}

/* Кнопки */
button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- ЛЕВАЯ ПАНЕЛЬ -->
<div id="sidebar">
    <h3>Страницы</h3>

    <div id="pageTree"></div>

    <button id="createPageBtn">Создать новую страницу</button>
    <button id="createSubPageBtn">Создать подстраницу</button>
</div>

<!-- ПРАВАЯ ОБЛАСТЬ -->
<div id="editor">
    <div id="editableContent"
         class="editable"
         contenteditable="true">
         Выберите страницу или создайте новую.
    </div>
</div>

<script>
// Хранилище: дерево страниц
let pages = JSON.parse(localStorage.getItem("pagesTree")) || {};
let currentPage = null;

// Сохранение дерева страниц
function savePages() {
    localStorage.setItem("pagesTree", JSON.stringify(pages));
}

// Генерация уникального ID
function uid() {
    return "p_" + Math.random().toString(36).substr(2, 9);
}

// Рендер дерева страниц
function renderPageTree() {
    const tree = document.getElementById("pageTree");
    tree.innerHTML = "";

    const renderNode = (node, container, isSub = false) => {
        const div = document.createElement("div");
        div.className = "page-item" + (isSub ? " subpage" : "");
        div.textContent = node.title;

        if (currentPage === node.id) div.classList.add("active");

        div.onclick = () => loadPage(node.id);
        container.appendChild(div);

        if (node.children) {
            node.children.forEach(child => renderNode(child, container, true));
        }
    };

    Object.values(pages).forEach(root => {
        renderNode(root, tree);
    });
}

// Создать новую страницу
document.getElementById("createPageBtn").onclick = () => {
    const title = prompt("Название новой страницы:");
    if (!title) return;

    const id = uid();
    pages[id] = {
        id,
        title,
        content: "Новая страница…",
        children: []
    };

    currentPage = id;
    savePages();
    renderPageTree();
    loadPage(id);
};

// Создать подстраницу
document.getElementById("createSubPageBtn").onclick = () => {
    if (!currentPage) {
        alert("Сначала выбери страницу, к которой добавить подстраницу.");
        return;
    }

    const title = prompt("Название подстраницы:");
    if (!title) return;

    const id = uid();

    const subpage = {
        id,
        title,
        content: "Новая подстраница…",
        children: []
    };

    pages[currentPage].children.push(subpage);

    savePages();
    renderPageTree();
    loadPage(id);
};

// Загрузить страницу
function loadPage(id) {
    const node = findNodeById(id);
    if (!node) return;

    currentPage = id;
    document.getElementById("editableContent").innerHTML = node.content;

    renderPageTree();
}

// Поиск страницы по ID (включая подстраницы)
function findNodeById(id) {
    for (let root of Object.values(pages)) {
        if (root.id === id) return root;

        let found = findSubpage(root, id);
        if (found) return found;
    }
    return null;
}

function findSubpage(node, id) {
    for (let child of node.children) {
        if (child.id === id) return child;
        let found = findSubpage(child, id);
        if (found) return found;
    }
    return null;
}

// Автосохранение при редактировании
document.getElementById("editableContent").addEventListener("input", () => {
    if (!currentPage) return;
    const node = findNodeById(currentPage);
    node.content = editableContent.innerHTML;
    savePages();
});

// Рендер при загрузке
renderPageTree();
</script>

</body>
</html>
